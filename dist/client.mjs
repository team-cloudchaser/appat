"use strict";let s=class{instanceId;#r=!0;#n=!0;#t;#o;#s;#e;constructor(e,t){if(!Request.prototype.hasOwnProperty("body"))throw this.#n=!1,new Error("Fetch requests do not support streamable bodies");if(typeof self?.WebSocketStream!="function")throw this.#r=!1,new Error("WebSocket does not support streaming");this.#o=t,this.#t=e}async start(){let e=this;if(e.#e)switch(e.#e.readyState){case WebSocket.CLOSING:case WebSocket.CLOSED:throw new Error("Attempted reconnection for an active dialer")}e.instanceId=self.crypto?.randomUUID(),e.#s=`${e.#t}/ws/${e.instanceId}`,e.#e=new WebSocket(`${e.#s}/ctrl?token=${e.#o}`),e.#e.addEventListener("error",t=>{console.warn("Control socket has errored out:",t.error)}),e.#e.addEventListener("close",t=>{console.warn("Control socket closed.")}),e.#e.addEventListener("opened",t=>{console.warn("Control socket is now ready.")}),e.#e.addEventListener("message",t=>{let n=JSON.parse(t.data);console.debug(n)})}};let r;self.location?.href?r=`${location.protocol}//${location.host}${location.pathname}`:self.Deno?.args[0]?.length>0?r=`http://${self.Deno.args[0]}`:r="http://127.0.0.1:5779";console.debug(`Received dialer prefix: ${r}`);let i="__CSRF_TOKEN__",o="__CSRF_TOKEN__";o===i&&(self.location?.search?.indexOf("?token=")===0?o=self.location.search.substring(7):self.Deno?.args[1]?.length>0?o=self.Deno.args[1]:o="00000000-0000-0000-0000-000000000000");console.debug(`Received CSRF token: ${o}`);let a=new s(r,o);await a.start();
