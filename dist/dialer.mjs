"use strict";let s=class{instanceId;#o=!0;#n=!0;#t;#s;#r;#e;constructor(e,t){if(!Request.prototype.hasOwnProperty("body"))throw this.#n=!1,new Error("Fetch requests do not support streamable bodies");if(typeof self?.WebSocketStream!="function")throw this.#o=!1,new Error("WebSocket does not support streaming");this.#s=t,this.#t=e}async start(){let e=this;if(e.#e)switch(e.#e.readyState){case WebSocket.CLOSING:case WebSocket.CLOSED:throw new Error("Attempted reconnection for an active dialer")}e.instanceId=self.crypto?.randomUUID(),e.#r=`${e.#t}/ws/${e.instanceId}`,e.#e=new WebSocket(`${e.#r}/ctrl?token=${e.#s}`),e.#e.addEventListener("error",t=>{console.warn("Control socket has errored out:",t.error)}),e.#e.addEventListener("close",t=>{console.warn("Control socket closed.")}),e.#e.addEventListener("opened",t=>{console.warn("Control socket is now ready.")}),e.#e.addEventListener("message",t=>{let r=JSON.parse(t.data);console.debug(r)})}};export{s as default};
